<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³•äººæ’è¡Œæ¦œ | Institutional Rankings</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
        }
        h1 {
            font-size: 2.2rem;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .subtitle { color: #888; font-size: 0.95rem; }
        .nav-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .nav-links a {
            color: #00d4ff;
            text-decoration: none;
            padding: 8px 16px;
            border: 1px solid rgba(0,212,255,0.3);
            border-radius: 20px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .nav-links a:hover {
            background: rgba(0,212,255,0.1);
            border-color: #00d4ff;
        }
        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .tab:hover { background: rgba(255,255,255,0.15); }
        .tab.active {
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            border: none;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
            gap: 20px;
        }
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.08);
        }
        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .card-header .icon { font-size: 1.5rem; }
        .card-title { font-size: 1.1rem; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 8px; text-align: left; }
        th { color: #888; font-size: 0.8rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        td { border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.9rem; }
        tr { cursor: pointer; transition: background 0.2s; }
        tr:hover { background: rgba(0,212,255,0.05); }
        .stock-code { color: #00d4ff; font-weight: 600; }
        .stock-name { color: #aaa; font-size: 0.85rem; }
        .positive { color: #2ecc71; }
        .negative { color: #e74c3c; }
        .days-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .days-high { background: linear-gradient(90deg, #e74c3c, #c0392b); }
        .days-mid { background: linear-gradient(90deg, #f39c12, #d68910); }
        .days-low { background: linear-gradient(90deg, #27ae60, #1e8449); }
        .loading { text-align: center; padding: 40px; color: #888; }
        .price { color: #888; }
        .industry-tag {
            font-size: 0.75rem;
            color: #888;
            background: rgba(255,255,255,0.1);
            padding: 2px 8px;
            border-radius: 8px;
        }
        footer { text-align: center; margin-top: 40px; padding: 20px; color: #666; font-size: 0.85rem; }
        @media (max-width: 900px) {
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ† æ³•äººæ’è¡Œæ¦œ</h1>
            <p class="subtitle">Institutional Investor Rankings</p>
            <div class="nav-links">
                <a href="/dashboard">ğŸ“Š ç­–ç•¥å„€è¡¨æ¿</a>
                <a href="/industry">ğŸ­ ç”¢æ¥­ç†±åŠ›åœ–</a>
                <a href="/ai">ğŸ¤– AI åˆ†æ</a>
                <a href="/brokers">ğŸ¦ åˆ¸å•†è¿½è¹¤</a>
                <a href="/live">ğŸ“ˆ å³æ™‚çœ‹æ¿</a>
            </div>
        </header>

        <div class="tabs">
            <div class="tab active" data-tab="consecutive">ğŸ”¥ å¤–è³‡é€£è²·</div>
            <div class="tab" data-tab="trust">ğŸ’ æŠ•ä¿¡èªé¤Š</div>
            <div class="tab" data-tab="sync">ğŸ¯ ä¸‰å¤§æ³•äººåŒæ­¥</div>
            <div class="tab" data-tab="deviation">ğŸ“‰ ä¹–é›¢éå¤§</div>
        </div>

        <div id="content">
            <div class="loading">è¼‰å…¥è³‡æ–™ä¸­...</div>
        </div>

        <footer>
            <div>è³‡æ–™ä¾†æºï¼šå°ç£è­‰åˆ¸äº¤æ˜“æ‰€ã€æ«ƒè²·ä¸­å¿ƒ | æ¯æ—¥ç›¤å¾Œæ›´æ–°</div>
        </footer>
    </div>

    <script>
        const API_BASE = '/api/v1/strategy';

        function formatNumber(num) {
            if (Math.abs(num) >= 10000) return (num/10000).toFixed(1) + 'è¬';
            if (Math.abs(num) >= 1000) return (num/1000).toFixed(1) + 'åƒ';
            return num.toFixed(0);
        }

        function getDaysBadgeClass(days) {
            if (days >= 10) return 'days-high';
            if (days >= 5) return 'days-mid';
            return 'days-low';
        }

        async function loadConsecutive() {
            try {
                const resp = await fetch(`${API_BASE}/consecutive-buying?limit=30`);
                const data = await resp.json();

                const html = `
                    <div class="card">
                        <div class="card-header">
                            <span class="icon">ğŸ”¥</span>
                            <span class="card-title">å¤–è³‡é€£çºŒè²·è¶…æ’è¡Œ (ä¾é€£çºŒå¤©æ•¸)</span>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>è‚¡ç¥¨</th>
                                    <th>ç”¢æ¥­</th>
                                    <th>è‚¡åƒ¹</th>
                                    <th>é€£è²·å¤©æ•¸</th>
                                    <th>ç´¯è¨ˆè²·è¶…</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.items.map((s, i) => `
                                    <tr onclick="window.location='/stock/${s.code}'">
                                        <td>${i + 1}</td>
                                        <td>
                                            <span class="stock-code">${s.code}</span>
                                            <span class="stock-name">${s.name}</span>
                                        </td>
                                        <td><span class="industry-tag">${s.industry || '-'}</span></td>
                                        <td class="price">${s.current_price ? s.current_price.toFixed(1) : '-'}</td>
                                        <td><span class="days-badge ${getDaysBadgeClass(s.consecutive_days)}">${s.consecutive_days} å¤©</span></td>
                                        <td class="positive">+${formatNumber(s.total_foreign_net)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                document.getElementById('content').innerHTML = html;
            } catch (e) {
                document.getElementById('content').innerHTML = '<div class="loading" style="color:#e74c3c">è¼‰å…¥å¤±æ•—</div>';
            }
        }

        async function loadTrust() {
            try {
                const resp = await fetch(`${API_BASE}/trust-accumulation?limit=30`);
                const data = await resp.json();

                const html = `
                    <div class="card">
                        <div class="card-header">
                            <span class="icon">ğŸ’</span>
                            <span class="card-title">æŠ•ä¿¡èªé¤Šè‚¡æ’è¡Œ (ä¾é€£çºŒè²·è¶…å¤©æ•¸)</span>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>è‚¡ç¥¨</th>
                                    <th>ç”¢æ¥­</th>
                                    <th>è‚¡åƒ¹</th>
                                    <th>é€£è²·å¤©æ•¸</th>
                                    <th>ç´¯è¨ˆè²·è¶…</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.items.map((s, i) => `
                                    <tr onclick="window.location='/stock/${s.code}'">
                                        <td>${i + 1}</td>
                                        <td>
                                            <span class="stock-code">${s.code}</span>
                                            <span class="stock-name">${s.name}</span>
                                        </td>
                                        <td><span class="industry-tag">${s.industry || '-'}</span></td>
                                        <td class="price">${s.current_price ? s.current_price.toFixed(1) : '-'}</td>
                                        <td><span class="days-badge ${getDaysBadgeClass(s.consecutive_days)}">${s.consecutive_days} å¤©</span></td>
                                        <td class="positive">+${formatNumber(s.total_trust_net)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                document.getElementById('content').innerHTML = html;
            } catch (e) {
                document.getElementById('content').innerHTML = '<div class="loading" style="color:#e74c3c">è¼‰å…¥å¤±æ•—</div>';
            }
        }

        async function loadSync() {
            try {
                const resp = await fetch(`${API_BASE}/synchronized-buying?limit=30`);
                const data = await resp.json();

                const html = `
                    <div class="card">
                        <div class="card-header">
                            <span class="icon">ğŸ¯</span>
                            <span class="card-title">ä¸‰å¤§æ³•äººåŒæ­¥è²·è¶… (è¿‘ ${data.days} æ—¥)</span>
                        </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>è‚¡ç¥¨</th>
                                    <th>è‚¡åƒ¹</th>
                                    <th>å¤–è³‡</th>
                                    <th>æŠ•ä¿¡</th>
                                    <th>è‡ªç‡Ÿ</th>
                                    <th>åˆè¨ˆ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.items.map((s, i) => `
                                    <tr onclick="window.location='/stock/${s.code}'">
                                        <td>${i + 1}</td>
                                        <td>
                                            <span class="stock-code">${s.code}</span>
                                            <span class="stock-name">${s.name}</span>
                                        </td>
                                        <td class="price">${s.current_price ? s.current_price.toFixed(1) : '-'}</td>
                                        <td class="positive">+${formatNumber(s.foreign_net)}</td>
                                        <td class="positive">+${formatNumber(s.trust_net)}</td>
                                        <td class="positive">+${formatNumber(s.dealer_net)}</td>
                                        <td class="positive"><strong>+${formatNumber(s.total_net)}</strong></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                document.getElementById('content').innerHTML = html;
            } catch (e) {
                document.getElementById('content').innerHTML = '<div class="loading" style="color:#e74c3c">è¼‰å…¥å¤±æ•—</div>';
            }
        }

        async function loadDeviation() {
            try {
                const resp = await fetch(`${API_BASE}/price-deviation?limit=30`);
                const data = await resp.json();

                const html = `
                    <div class="grid">
                        <div class="card">
                            <div class="card-header">
                                <span class="icon">ğŸ“ˆ</span>
                                <span class="card-title">æ­£ä¹–é›¢éå¤§ (è‚¡åƒ¹é«˜æ–¼å‡ç·š)</span>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>è‚¡ç¥¨</th>
                                        <th>è‚¡åƒ¹</th>
                                        <th>20MA</th>
                                        <th>ä¹–é›¢ç‡</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.items.filter(s => s.deviation_pct > 0).slice(0, 15).map(s => `
                                        <tr onclick="window.location='/stock/${s.code}'">
                                            <td>
                                                <span class="stock-code">${s.code}</span>
                                                <span class="stock-name">${s.name}</span>
                                            </td>
                                            <td class="price">${s.current_price ? s.current_price.toFixed(1) : '-'}</td>
                                            <td class="price">${s.ma20 ? s.ma20.toFixed(1) : '-'}</td>
                                            <td class="positive">+${s.deviation_pct.toFixed(1)}%</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <span class="icon">ğŸ“‰</span>
                                <span class="card-title">è² ä¹–é›¢éå¤§ (è‚¡åƒ¹ä½æ–¼å‡ç·š)</span>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>è‚¡ç¥¨</th>
                                        <th>è‚¡åƒ¹</th>
                                        <th>20MA</th>
                                        <th>ä¹–é›¢ç‡</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.items.filter(s => s.deviation_pct < 0).slice(0, 15).map(s => `
                                        <tr onclick="window.location='/stock/${s.code}'">
                                            <td>
                                                <span class="stock-code">${s.code}</span>
                                                <span class="stock-name">${s.name}</span>
                                            </td>
                                            <td class="price">${s.current_price ? s.current_price.toFixed(1) : '-'}</td>
                                            <td class="price">${s.ma20 ? s.ma20.toFixed(1) : '-'}</td>
                                            <td class="negative">${s.deviation_pct.toFixed(1)}%</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                document.getElementById('content').innerHTML = html;
            } catch (e) {
                document.getElementById('content').innerHTML = '<div class="loading" style="color:#e74c3c">è¼‰å…¥å¤±æ•—</div>';
            }
        }

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('content').innerHTML = '<div class="loading">è¼‰å…¥è³‡æ–™ä¸­...</div>';
                const tabId = tab.dataset.tab;
                if (tabId === 'consecutive') loadConsecutive();
                else if (tabId === 'trust') loadTrust();
                else if (tabId === 'sync') loadSync();
                else if (tabId === 'deviation') loadDeviation();
            });
        });

        loadConsecutive();
    </script>
</body>
</html>
